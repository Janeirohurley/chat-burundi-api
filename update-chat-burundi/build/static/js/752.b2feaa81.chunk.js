"use strict";(self.webpackChunkupdate_chat_burundi=self.webpackChunkupdate_chat_burundi||[]).push([[752],{5752:function(e,t,n){n.r(t),n.d(t,{default:function(){return B}});var r=n(4165),s=n(5861),i=n(9439),o=n(1413),c=n(2791),a=n(2010),u=n(9434),l=n(1243),d=n(4212),p=n(184),h=function(e){var t=e.userData,n=e.commentaire,o=e.postId,h=(0,c.useState)(!1),m=(0,i.Z)(h,2),f=m[0],x=m[1],j=(0,c.useState)(""),v=(0,i.Z)(j,2),g=v[0],Z=v[1],b=(0,u.I0)(),k=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,n,s){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=5;break}return e.next=3,(0,l.Z)({method:"patch",url:"".concat(d.L,"/api/post/edit-comment-post/").concat(s),withCredentials:!0,data:{commentId:t,text:n}}).then((function(e){e.data;b(a.J.EditComment({postId:s,text:n,commentId:t})),x(!1)})).catch((function(e){return console.log(e)}));case 3:e.next=6;break;case 5:x(!1);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),w=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Z)({method:"patch",url:"".concat(d.L,"/api/post/delet-comment-post/").concat(t),withCredentials:!0,data:{commentId:n}}).then((function(e){e.data;b(a.J.DeleteComment({postId:t,commentId:n})),x(!1)})).catch((function(e){return console.log(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,p.jsxs)(p.Fragment,{children:[t._id===n.commenterId&&(0,p.jsxs)(p.Fragment,{children:[!1===f&&(0,p.jsx)("small",{children:(0,p.jsx)("i",{onClick:function(){return x(!0)},className:"ri-edit-line"})}),!0===f&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("br",{}),(0,p.jsx)("textarea",{defaultValue:n.text,onChange:function(e){return Z(e.target.value)}}),(0,p.jsx)("button",{className:"btn-new-comm",onClick:function(){return k(n._id,g,o)},children:(0,p.jsx)("i",{className:"ri-check-line"})})]})]}),"  ",t._id===n.commenterId&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("small",{children:(0,p.jsx)("i",{onClick:function(){return w(o,n._id)},className:"ri-delete-bin-line"})})," ",f&&(0,p.jsx)("small",{children:(0,p.jsx)("i",{onClick:function(){return x(!1)},className:"ri-refresh-line"})})]})]})},m=n(7863),f=n(7527),x=n(1582),j=n(9891),v=function(e){var t=e.post,n=e.setUpdated,o=e.isUpdated,h=(0,u.I0)(),v=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("voulez-vous vraiment supprimer ce post ??")){e.next=4;break}return h(a.J.DeletePost(t._id)),e.next=4,(0,l.Z)({method:"delete",url:"".concat(d.L,"/api/post/").concat(t._id),withCredentials:!0}).then((function(e){alert("post was deleted successifull"),console.log(e)})).catch((function(e){return console.log(e)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=[{title:"Delete"},{title:o?"Discard":"Edit"},{title:"Share"}],Z=(0,c.useState)(null),b=(0,i.Z)(Z,2),k=b[0],w=b[1],N=Boolean(k),C=function(){w(null)};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(m.Z,{id:"basic-button","aria-controls":N?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":N?"true":void 0,onClick:function(e){w(e.currentTarget)},size:20,cursor:"pointer"}),(0,p.jsx)(f.Z,{id:"basic-menu",anchorEl:k,open:N,onClose:C,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,p.jsx)(x.Z,{p:1,px:1,children:g.map((function(e){return(0,p.jsx)(j.Z,{onClick:function(){return function(e){switch(e){case"Delete":return v();case o?"Discard":"Edit":return C(),n((function(e){return!e}));case"Share":return alert("Share button");default:return 0}}(e.title)},children:e.title},Math.random())}))})})]})},g=n(5194),Z=n(1896),b=n(6587),k=n(1697),w=function(e){var t=e.post,n=e.socket,o=(0,c.useState)(!1),h=(0,i.Z)(o,2),m=h[0],f=h[1],x=(0,u.I0)(),j=(0,c.useContext)(k.i),v=(0,u.v9)((function(e){return e.userInfo})),g=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,s,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),x(a.J.LikePost({postId:t,userId:i})),e.next=4,(0,l.Z)({method:"patch",url:"".concat(d.L,"/api/post/like/").concat(t),data:{id:i},withCredentials:!0}).then((function(e){n.emit("sendNotification",{senderName:i,postLiked:t,resverName:s,timeNot:new Date}),(0,l.Z)({method:"patch",url:"".concat(d.L,"/api/post/notification/").concat(s),data:{notifieId:v._id,notifiePseudo:v.pseudo,notification:"like your post",post:t,status:"pending",pictureNotifie:v.picture},withCredentials:!0}).then((function(e){console.log(e)})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Z=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!1),x(a.J.UnlikePost({postId:t,userId:n})),e.next=4,(0,l.Z)({method:"patch",url:"".concat(d.L,"/api/post/unlike/").concat(t),data:{id:n},withCredentials:!0}).then((function(e){e.data})).catch((function(e){return console.log(e)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,c.useEffect)((function(){t.likers.includes(j)&&f(!0)}),[j,t.likers,m]),(0,p.jsxs)(p.Fragment,{children:[m&&(0,p.jsx)("i",{onClick:function(){return Z(t._id,j)},className:"ri-heart-pulse-fill",children:(0,p.jsx)("small",{children:t.likers.length})}),!1===m&&(0,p.jsx)("i",{onClick:function(){return g(t._id,t.posterId,j)},className:"ri-heart-pulse-line",children:(0,p.jsx)("small",{children:t.likers.length})})]})},N=n(7498),C=n(6151),I=n(3543),y=n(3400),_=n(9658),S=c.forwardRef((function(e,t){return(0,p.jsx)(_.Z,(0,o.Z)({elevation:6,ref:t,variant:"filled"},e))})),P=function(e){var t=e.post,n=e.userData,o=(0,c.useContext)(k.i),a=(0,c.useState)(!1),h=(0,i.Z)(a,2),m=h[0],f=h[1],x=(0,c.useState)(!1),j=(0,i.Z)(x,2),v=j[0],g=j[1],b=(0,u.I0)(),w=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(N.Z.SavePost(t)),f(!0),e.next=4,(0,l.Z)({method:"put",url:"".concat(d.L,"/api/user/savepost/").concat(n),data:{idPostTosave:t},withCredentials:!0}).then((function(e){e.data;return g(!0)})).catch((function(e){return console.log(e)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(N.Z.UnsavePost(t)),f(!1),e.next=4,(0,l.Z)({method:"put",url:"".concat(d.L,"/api/user/unsavepost/").concat(n),data:{idPostTounsave:t},withCredentials:!0}).then((function(e){e.data;f(!1),g(!0)})).catch((function(e){return console.log(e)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){(0,Z.xb)(n)||n&&n.saved.includes(t._id)&&f(!0)}),[t,m,n.saved,t._id,n]);var P=function(e,t){"clickaway"!==t&&g(!1)},F=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.Z,{color:"secondary",size:"small",onClick:P,children:"UNDO"}),(0,p.jsx)(y.Z,{size:"small","aria-label":"close",color:"inherit",onClick:P})]});return(0,p.jsxs)("div",{className:"bookmark",children:[m&&(0,p.jsx)("i",{onClick:function(){return _(t._id,o)},className:"ri-bookmark-fill"}),!1===m&&(0,p.jsx)("i",{onClick:function(){return w(t._id,o)},className:"ri-bookmark-line"}),(0,p.jsx)(I.Z,{open:v,autoHideDuration:6e3,onClose:P,message:m?"post saved sussessifuly":"post unsaved sussessifuly",action:F,children:(0,p.jsx)(S,{onClose:P,severity:"success",sx:{width:"100%"},children:m?"post saved sussessifuly":"post unsaved sussessifuly"})})]})},F=n(3044),L=n(890),D=n(4554),E=n(6463),M=n(1087),U=(0,c.memo)((function(e){for(var t=e.post,n=(0,u.v9)((function(e){return e.getusers})),r=(0,c.useContext)(k.i),s=[],i=0;i<=2;i++)for(var o=0;o<n.length;o++)t.likers[i]===n[o]._id&&s.push(n[o]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"liked_by",children:[(0,p.jsx)(p.Fragment,{children:3===s.length&&s.map((function(e){return(0,p.jsx)("span",{children:(0,p.jsx)(F.Z,{src:!(0,Z.xb)(s)&&e.picture,alt:"assa",sx:{width:"100%",height:"100%",zoom:"50%"}})},Math.random())}))}),(0,p.jsxs)("p",{children:["liked by ",(0,p.jsx)("b",{children:!(0,Z.xb)(s)&&s[0].pseudo})," ,",(0,p.jsx)("b",{children:3===s.length&&s[1].pseudo})," "]})]}),(0,p.jsx)("div",{className:"caption",children:(0,p.jsxs)(L.Z,{variant:"caption",children:[(0,p.jsxs)("b",{children:[!(0,Z.xb)(t.comments)&&(0,p.jsxs)(p.Fragment,{children:[" ",t.comments[0].commenterId===r?"You":t.comments[0].commenterPseudo]})," "]})," ",!(0,Z.xb)(t.comments)&&t.comments[0].text]})}),(0,p.jsx)("div",{className:" comments text-muted",children:(0,p.jsx)(M.rU,{to:"/single/post/".concat(t._id),children:(0,p.jsxs)("small",{children:[" ","view all ",!(0,Z.xb)(t.comments)&&t.comments.length," comments"]})})})]})})),z=n(7087),T=function(e){var t=(0,c.useState)(!1),n=(0,i.Z)(t,2),r=n[0],s=n[1],a=(0,c.useRef)(),u=function(e,t){e.forEach((function(e){e.isIntersecting&&setTimeout((function(){return s(!0)}),1e3)}))};return(0,c.useEffect)((function(){var e=new IntersectionObserver(u);return null!==a&&void 0!==a&&a.current&&e.observe(a.current),function(){e.disconnect()}}),[]),r?(0,p.jsx)(z.LazyLoadImage,(0,o.Z)((0,o.Z)({width:"100%"},e),{},{alt:"post-pict",effect:"blur",placeholderSrc:e.src})):(0,p.jsx)("div",{ref:a,style:{width:"100%",height:"200px",backgroundImage:" linear-gradient( 135deg, #FFE985 10%, #FA742B 100%)"},id:e.id})},J=n(5392),R=c.forwardRef((function(e,t){return(0,p.jsx)(_.Z,(0,o.Z)({elevation:6,ref:t,variant:"filled"},e))})),A=(0,c.memo)((function(e){var t=e.post,n=e.socket,o=e.count,m=(0,c.useState)(!0),f=(0,i.Z)(m,2),j=f[0],k=f[1],N=(0,c.useState)(!1),_=(0,i.Z)(N,2),S=_[0],z=_[1],A=(0,c.useState)(""),B=(0,i.Z)(A,2),H=B[0],O=B[1],W=(0,c.useState)(!1),q=(0,i.Z)(W,2),V=q[0],G=q[1],X=(0,c.useState)(!1),Y=(0,i.Z)(X,2),K=Y[0],Q=Y[1],$=(0,c.useState)(!1),ee=(0,i.Z)($,2),te=ee[0],ne=ee[1],re=(0,c.useState)(!1),se=(0,i.Z)(re,2),ie=se[0],oe=se[1],ce=(0,c.useState)(null),ae=(0,i.Z)(ce,2),ue=ae[0],le=ae[1],de=(0,u.v9)((function(e){return e.getusers})),pe=(0,u.v9)((function(e){return e.userInfo})),he=(0,u.I0)(),me=(0,c.useState)(),fe=(0,i.Z)(me,2),xe=fe[0],je=fe[1],ve=(0,c.useState)(),ge=(0,i.Z)(ve,2),Ze=ge[0],be=ge[1];(0,c.useEffect)((function(){!(0,Z.xb)(de[0])&&k(!1)}),[de]);var ke=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ue){e.next=4;break}return Q(!0),e.next=4,(0,l.Z)({method:"put",url:"".concat(d.L,"/api/post/").concat(t),data:{message:ue,color:Ze},withCredentials:!0}).then((function(e){setTimeout((function(){he(a.J.UpdatePost({postId:t,message:n})),G(!0),ne(!1),Q(!1),be("")}),2e3)})).catch((function(e){return console.log(e)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),we=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!H){e.next=6;break}return oe(!0),e.next=4,(0,l.Z)({method:"patch",url:"".concat(d.L,"/api/post/comment-post/").concat(t),withCredentials:!0,data:{commenterId:pe._id,commenterPseudo:pe.pseudo,text:H}}).then((function(e){e.data;oe(!1),O(""),(0,l.Z)({method:"patch",url:"".concat(d.L,"/api/post/notification/").concat(i),data:{notifieId:pe._id,notifiePseudo:pe.pseudo,notification:"comment to ur post",post:t,status:"pending",pictureNotifie:pe.picture},withCredentials:!0}).then((function(e){console.log(e),n.emit("sendNotification",{senderName:pe._id,resverName:i,timeNot:new Date})})).catch((function(e){return console.log(e)}));var c=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Z)({method:"GET",url:d.L+"/api/post/",withCredentials:!0}).then((function(e){var t=e.data.slice(0,o);console.log("fetch again from card");for(var n=0;n<t.length;n++)t[n].comments.reverse();he(a.J.fetchAllPosts((0,Z.MN)(t,pe.following,pe._id)))})).catch((function(e){console.log(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();c()})).catch((function(e){console.log(e.message)}));case 4:e.next=7;break;case 6:alert("can't comment empty fill a field");case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ne=function(e,t){"clickaway"!==t&&G(!1)},Ce=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.Z,{color:"secondary",size:"small",onClick:Ne,children:"UNDO"}),(0,p.jsx)(y.Z,{size:"small","aria-label":"close",color:"inherit",onClick:Ne})]});return(0,c.useEffect)((function(){!function(){for(var e=[],t=0;t<8;t++){var n=["yellow","white","gray","gold","blue","silver","turquoise","cyan","brown","pink","purple","green"],r="linear-gradient(to bottom right, rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+"), "+n[Math.floor(Math.random()*n.length)]+")";e.push(r)}je(e)}()}),[]),(0,c.useEffect)((function(){document.querySelectorAll(".colorPallete span").forEach((function(e){e.addEventListener("click",(function(e){be(e.target.id)}))}))})),(0,p.jsxs)("div",{className:"feed",children:[j?(0,p.jsx)(g.Z,{}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"head",children:[(0,p.jsxs)("div",{className:"user",children:[(0,p.jsx)("div",{className:"profile-picture ",children:(0,p.jsx)(F.Z,{src:!(0,Z.xb)(de[0])&&de.map((function(e){return e._id===t.posterId?e.picture:null})).join(""),alt:"ss"})}),(0,p.jsxs)("div",{className:"ingo",children:[(0,p.jsx)("span",{children:(0,p.jsxs)("h5",{className:"noum",children:[(0,p.jsx)(M.rU,{className:"linkProfile",to:"/profile/".concat(t.posterId),children:!(0,Z.xb)(de[0])&&de.map((function(e){return e._id===t.posterId?e.pseudo:null})).join("")})," ",t.posterId!==pe._id&&(0,p.jsx)(b.Z,{idTofollow:t.posterId,type:"card",socket:n})]})}),(0,p.jsx)(L.Z,{variant:"caption",children:(0,Z.RX)(t.createdAt)})]})]}),(0,p.jsx)("span",{className:"edit",children:t.posterId===pe._id&&(0,p.jsx)(v,{post:t,setUpdated:ne,isUpdated:te})})]}),(0,p.jsxs)("div",{className:"news",children:[te&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("textarea",{defaultValue:t.message,onChange:function(e){return le(e.target.value)}}),(0,p.jsx)("button",{className:"btn-new",onClick:function(){return ke(t._id,ue)},children:(0,p.jsx)(E.Z,{loading:K,sx:{padding:"0px",height:"10px",color:"white",textTransform:"lowercase"},children:"update"})}),(0,p.jsx)("button",{className:"btn-new",onClick:function(){return ne(!1)},children:"discard"})]}),!1===te&&!t.video&&!t.picture&&(0,p.jsx)(J.Z,{type:"posts",text:t.message,color:t.color}),!0===te&&!t.video&&!t.picture&&(0,p.jsx)(J.Z,{type:"posts",text:t.message,color:Ze||t.color}),!1===te&&(t.video||t.picture)&&(0,p.jsx)("b",{children:t.message})]}),(0,p.jsxs)("div",{className:"photo",children:[t.picture&&(0,p.jsx)(T,{id:t._id,src:t.picture},t._id),t.video&&(0,p.jsx)("iframe",{width:"400",height:"250",src:t.video,title:Math.random()})]}),(0,p.jsxs)("div",{className:"action-buttons",children:[(0,p.jsxs)("div",{className:"interaction-buttons",children:[(0,p.jsx)(w,{post:t,socket:n}),"  ",(0,p.jsx)("i",{onClick:function(){return z((function(e){return!e}))},className:"ri-chat-3-line",children:(0,p.jsx)("small",{children:t.comments.length})}),"  ",(0,p.jsx)("i",{className:"ri-share-line"})]}),t.posterId!==pe._id&&(0,p.jsx)(P,{post:t,userData:pe})]}),t.likers.length>2&&(0,p.jsx)(U,{post:t}),S&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(D.Z,{sx:{display:"flex",gap:2},children:[(0,p.jsx)(F.Z,{src:pe.picture,sx:{width:"25px",height:"25px"}}),(0,p.jsx)(L.Z,{width:"95%",children:(0,p.jsx)("input",{className:"commentInput",placeholder:"give ur idea....",onChange:function(e){return O(e.target.value)},value:H})}),(0,p.jsx)("button",{onClick:function(){return we(t._id,t.posterId)},className:ie?"disableButton btn-new":"btn-new",children:ie?"waiting..":"send"})]}),(0,p.jsx)(p.Fragment,{children:t.comments.map((function(e){return(0,p.jsx)(x.Z,{className:"commentBox",direction:"column",spacing:1,p:1,children:(0,p.jsxs)(D.Z,{sx:{display:"flex",gap:2},children:[(0,p.jsx)(F.Z,{src:!(0,Z.xb)(de[0])&&de.map((function(t){return t._id===e.commenterId?t.picture:null})).join(""),alt:"ss",sx:{width:"25px",height:"25px"}}),(0,p.jsxs)(D.Z,{sx:{display:"inline-block",gap:2},children:[(0,p.jsx)(M.rU,{className:"linkProfile",to:"/profile/".concat(null===e||void 0===e?void 0:e.commenterId),children:(0,p.jsx)(L.Z,{variant:"caption",children:!(0,Z.xb)(t.comments)&&e.commenterPseudo})})," ",pe._id!==e.commenterId&&(0,p.jsx)(b.Z,{idTofollow:e.commenterId,type:"card"}),(0,p.jsx)(L.Z,{variant:"body2",sx:{padding:"3px 4px",background:"#888",fontSize:"0.8rem",borderRadius:"10px",minWidth:"100px",maxWidth:"300px",minHeight:"40px",wordWrap:"break-word",position:"relative","'&:before'":{width:"30px",height:"30px",background:"red",position:"absolute"}},children:!(0,Z.xb)(t.comments)&&e.text}),(0,p.jsx)(h,{userData:pe,commentaire:e,postId:t._id}),(0,p.jsx)(L.Z,{variant:"caption",children:(0,Z.Mp)(e.timestamp)})]})]})},e._id)}))})]}),(0,p.jsx)(I.Z,{open:V,autoHideDuration:6e3,onClose:Ne,action:Ce,children:(0,p.jsx)(R,{onClose:Ne,severity:"success",sx:{width:"100%"},children:"post has been updated succussifull"})})]}),te&&!t.video&&!t.picture&&(0,p.jsxs)("div",{className:"colorPallete",children:[xe&&xe.map((function(e,t){return(0,p.jsx)("span",{id:e,style:{backgroundImage:e}},t)})),(0,p.jsx)("span",{children:(0,p.jsx)("input",{type:"color"})})]})]},t._id)})),B=A},5392:function(e,t,n){n(2791);var r=n(184);t.Z=function(e){var t=e.text,n=e.type,s=e.color;return(0,r.jsxs)("div",{style:{backgroundImage:s||" linear-gradient(to right bottom, rgb(228, 64, 92), purple)"},className:"cardCanvas",children:["trending"===n&&(0,r.jsx)("p",{children:t}),"posts"===n&&(0,r.jsx)("h3",{children:t})]})}}}]);
//# sourceMappingURL=752.b2feaa81.chunk.js.map